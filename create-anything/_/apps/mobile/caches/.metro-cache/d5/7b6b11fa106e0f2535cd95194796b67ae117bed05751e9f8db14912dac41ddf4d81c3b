{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":34,"index":34}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"expo-router","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":35},"end":{"line":2,"column":40,"index":75}}],"key":"/+ErnBisjrT6aDU+GRp5Qz/lYoY=","exportNames":["*"],"imports":1}},{"name":"@/utils/auth/useAuth","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":76},"end":{"line":3,"column":47,"index":123}}],"key":"OwmwtjBeuaoeWH+HHIznha/uOFE=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return Index;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _react = require(_dependencyMap[1], \"react\");\n  var _expoRouter = require(_dependencyMap[2], \"expo-router\");\n  var _utilsAuthUseAuth = require(_dependencyMap[3], \"@/utils/auth/useAuth\");\n  function Index() {\n    _s();\n    var router = (0, _expoRouter.useRouter)();\n    var _useAuth = (0, _utilsAuthUseAuth.useAuth)(),\n      isReady = _useAuth.isReady,\n      auth = _useAuth.auth;\n    (0, _react.useEffect)(() => {\n      var routeNext = /*#__PURE__*/function () {\n        var _ref = (0, _asyncToGenerator.default)(function* () {\n          if (!isReady) return;\n          console.log(\"[INDEX] Starting route logic, isReady:\", isReady, \"auth:\", !!auth);\n\n          // Not authenticated -> Welcome\n          if (!auth) {\n            console.log(\"[INDEX] No auth, redirecting to welcome\");\n            router.replace(\"/onboarding/welcome\");\n            return;\n          }\n          try {\n            console.log(\"[INDEX] Fetching profile...\");\n            var res = yield fetch(\"/api/profile\");\n            console.log(\"[INDEX] Profile fetch status:\", res.status);\n            if (res.ok) {\n              var data = yield res.json();\n              var user = data?.user;\n              var media = data?.media || [];\n              var photos = media.filter(m => m.type === \"photo\");\n              console.log(\"[INDEX] User data:\", {\n                hasUser: !!user,\n                consent: user?.consent_accepted,\n                tier: user?.membership_tier,\n                name: user?.name,\n                photoCount: photos.length\n              });\n\n              // NEW FLOW: Check consent first (Step 2 before membership)\n              if (!user?.consent_accepted) {\n                console.log(\"[INDEX] No consent, redirecting to consent\");\n                var returnTo = \"/onboarding/membership\";\n                router.replace(`/onboarding/consent?returnTo=${encodeURIComponent(returnTo)}`);\n                return;\n              }\n\n              // Membership gate (Step 3)\n              if (!user?.membership_tier) {\n                console.log(\"[INDEX] No membership tier, redirecting to membership\");\n                router.replace(\"/onboarding/membership\");\n                return;\n              }\n\n              // Profile completion gate (Step 4 - consolidated)\n              // Require name AND minimum 2 photos to ensure profile is properly completed\n              if (!user?.name || photos.length < 2) {\n                console.log(\"[INDEX] Incomplete profile (name or photos), redirecting to profile setup\");\n                router.replace(\"/onboarding/profile\");\n                return;\n              }\n\n              // All checks passed -> main app\n              console.log(\"[INDEX] All checks passed, redirecting to discovery\");\n              router.replace(\"/(tabs)/discovery\");\n              return;\n            }\n          } catch (e) {\n            console.error(\"[INDEX] Error during route logic:\", e);\n          }\n\n          // Fallback\n          console.log(\"[INDEX] Fallback triggered, redirecting to discovery\");\n          router.replace(\"/(tabs)/discovery\");\n        });\n        return function routeNext() {\n          return _ref.apply(this, arguments);\n        };\n      }();\n      routeNext();\n    }, [isReady, auth, router]);\n    return null;\n  }\n  _s(Index, \"1ebaCb4fb+n283sTuLOePoZ/b3c=\", false, function () {\n    return [_expoRouter.useRouter, _utilsAuthUseAuth.useAuth];\n  });\n  _c = Index;\n  var _c;\n  $RefreshReg$(_c, \"Index\");\n});","lineCount":109,"map":[[13,2,5,15,"Object"],[13,8,5,15],[13,9,5,15,"defineProperty"],[13,23,5,15],[13,24,5,15,"exports"],[13,31,5,15],[14,4,5,15,"enumerable"],[14,14,5,15],[15,4,5,15,"get"],[15,7,5,15],[15,18,5,15,"get"],[15,19,5,15],[16,6,5,15],[16,13,5,15,"Index"],[16,18,5,15],[17,4,5,15],[18,2,5,15],[19,2,82,1],[19,6,82,1,"_babelRuntimeHelpersAsyncToGenerator"],[19,42,82,1],[19,45,82,1,"require"],[19,52,82,1],[19,53,82,1,"_dependencyMap"],[19,67,82,1],[20,2,82,1],[20,6,82,1,"_asyncToGenerator"],[20,23,82,1],[20,26,82,1,"_interopDefault"],[20,41,82,1],[20,42,82,1,"_babelRuntimeHelpersAsyncToGenerator"],[20,78,82,1],[21,2,1,0],[21,6,1,0,"_react"],[21,12,1,0],[21,15,1,0,"require"],[21,22,1,0],[21,23,1,0,"_dependencyMap"],[21,37,1,0],[22,2,2,0],[22,6,2,0,"_expoRouter"],[22,17,2,0],[22,20,2,0,"require"],[22,27,2,0],[22,28,2,0,"_dependencyMap"],[22,42,2,0],[23,2,3,0],[23,6,3,0,"_utilsAuthUseAuth"],[23,23,3,0],[23,26,3,0,"require"],[23,33,3,0],[23,34,3,0,"_dependencyMap"],[23,48,3,0],[24,2,5,15],[24,11,5,24,"Index"],[24,16,5,29,"Index"],[24,17,5,29],[24,19,5,32],[25,4,5,32,"_s"],[25,6,5,32],[26,4,6,2],[26,8,6,8,"router"],[26,14,6,14],[26,17,6,17],[26,21,6,17,"useRouter"],[26,32,6,26],[26,33,6,26,"useRouter"],[26,42,6,26],[26,44,6,27],[26,45,6,28],[27,4,7,2],[27,8,7,2,"_useAuth"],[27,16,7,2],[27,19,7,28],[27,23,7,28,"useAuth"],[27,40,7,35],[27,41,7,35,"useAuth"],[27,48,7,35],[27,50,7,36],[27,51,7,37],[28,6,7,10,"isReady"],[28,13,7,17],[28,16,7,17,"_useAuth"],[28,24,7,17],[28,25,7,10,"isReady"],[28,32,7,17],[29,6,7,19,"auth"],[29,10,7,23],[29,13,7,23,"_useAuth"],[29,21,7,23],[29,22,7,19,"auth"],[29,26,7,23],[30,4,9,2],[30,8,9,2,"useEffect"],[30,14,9,11],[30,15,9,11,"useEffect"],[30,24,9,11],[30,26,9,12],[30,32,9,18],[31,6,10,4],[31,10,10,10,"routeNext"],[31,19,10,19],[32,8,10,19],[32,12,10,19,"_ref"],[32,16,10,19],[32,23,10,19,"_asyncToGenerator"],[32,40,10,19],[32,41,10,19,"default"],[32,48,10,19],[32,50,10,22],[32,63,10,34],[33,10,11,6],[33,14,11,10],[33,15,11,11,"isReady"],[33,22,11,18],[33,24,11,20],[34,10,13,6,"console"],[34,17,13,13],[34,18,13,14,"log"],[34,21,13,17],[34,22,13,18],[34,62,13,58],[34,64,13,60,"isReady"],[34,71,13,67],[34,73,13,69],[34,80,13,76],[34,82,13,78],[34,83,13,79],[34,84,13,80,"auth"],[34,88,13,84],[34,89,13,85],[36,10,15,6],[37,10,16,6],[37,14,16,10],[37,15,16,11,"auth"],[37,19,16,15],[37,21,16,17],[38,12,17,8,"console"],[38,19,17,15],[38,20,17,16,"log"],[38,23,17,19],[38,24,17,20],[38,65,17,61],[38,66,17,62],[39,12,18,8,"router"],[39,18,18,14],[39,19,18,15,"replace"],[39,26,18,22],[39,27,18,23],[39,48,18,44],[39,49,18,45],[40,12,19,8],[41,10,20,6],[42,10,22,6],[42,14,22,10],[43,12,23,8,"console"],[43,19,23,15],[43,20,23,16,"log"],[43,23,23,19],[43,24,23,20],[43,53,23,49],[43,54,23,50],[44,12,24,8],[44,16,24,14,"res"],[44,19,24,17],[44,28,24,26,"fetch"],[44,33,24,31],[44,34,24,32],[44,48,24,46],[44,49,24,47],[45,12,25,8,"console"],[45,19,25,15],[45,20,25,16,"log"],[45,23,25,19],[45,24,25,20],[45,55,25,51],[45,57,25,53,"res"],[45,60,25,56],[45,61,25,57,"status"],[45,67,25,63],[45,68,25,64],[46,12,27,8],[46,16,27,12,"res"],[46,19,27,15],[46,20,27,16,"ok"],[46,22,27,18],[46,24,27,20],[47,14,28,10],[47,18,28,16,"data"],[47,22,28,20],[47,31,28,29,"res"],[47,34,28,32],[47,35,28,33,"json"],[47,39,28,37],[47,40,28,38],[47,41,28,39],[48,14,29,10],[48,18,29,16,"user"],[48,22,29,20],[48,25,29,23,"data"],[48,29,29,27],[48,31,29,29,"user"],[48,35,29,33],[49,14,30,10],[49,18,30,16,"media"],[49,23,30,21],[49,26,30,24,"data"],[49,30,30,28],[49,32,30,30,"media"],[49,37,30,35],[49,41,30,39],[49,43,30,41],[50,14,31,10],[50,18,31,16,"photos"],[50,24,31,22],[50,27,31,25,"media"],[50,32,31,30],[50,33,31,31,"filter"],[50,39,31,37],[50,40,31,39,"m"],[50,41,31,40],[50,45,31,45,"m"],[50,46,31,46],[50,47,31,47,"type"],[50,51,31,51],[50,56,31,56],[50,63,31,63],[50,64,31,64],[51,14,33,10,"console"],[51,21,33,17],[51,22,33,18,"log"],[51,25,33,21],[51,26,33,22],[51,46,33,42],[51,48,33,44],[52,16,34,12,"hasUser"],[52,23,34,19],[52,25,34,21],[52,26,34,22],[52,27,34,23,"user"],[52,31,34,27],[53,16,35,12,"consent"],[53,23,35,19],[53,25,35,21,"user"],[53,29,35,25],[53,31,35,27,"consent_accepted"],[53,47,35,43],[54,16,36,12,"tier"],[54,20,36,16],[54,22,36,18,"user"],[54,26,36,22],[54,28,36,24,"membership_tier"],[54,43,36,39],[55,16,37,12,"name"],[55,20,37,16],[55,22,37,18,"user"],[55,26,37,22],[55,28,37,24,"name"],[55,32,37,28],[56,16,38,12,"photoCount"],[56,26,38,22],[56,28,38,24,"photos"],[56,34,38,30],[56,35,38,31,"length"],[57,14,39,10],[57,15,39,11],[57,16,39,12],[59,14,41,10],[60,14,42,10],[60,18,42,14],[60,19,42,15,"user"],[60,23,42,19],[60,25,42,21,"consent_accepted"],[60,41,42,37],[60,43,42,39],[61,16,43,12,"console"],[61,23,43,19],[61,24,43,20,"log"],[61,27,43,23],[61,28,43,24],[61,72,43,68],[61,73,43,69],[62,16,44,12],[62,20,44,18,"returnTo"],[62,28,44,26],[62,31,44,29],[62,55,44,53],[63,16,45,12,"router"],[63,22,45,18],[63,23,45,19,"replace"],[63,30,45,26],[63,31,45,27],[63,63,45,59,"encodeURIComponent"],[63,81,45,77],[63,82,45,78,"returnTo"],[63,90,45,86],[63,91,45,87],[63,93,45,89],[63,94,45,90],[64,16,46,12],[65,14,47,10],[67,14,49,10],[68,14,50,10],[68,18,50,14],[68,19,50,15,"user"],[68,23,50,19],[68,25,50,21,"membership_tier"],[68,40,50,36],[68,42,50,38],[69,16,51,12,"console"],[69,23,51,19],[69,24,51,20,"log"],[69,27,51,23],[69,28,51,24],[69,83,51,79],[69,84,51,80],[70,16,52,12,"router"],[70,22,52,18],[70,23,52,19,"replace"],[70,30,52,26],[70,31,52,27],[70,55,52,51],[70,56,52,52],[71,16,53,12],[72,14,54,10],[74,14,56,10],[75,14,57,10],[76,14,58,10],[76,18,58,14],[76,19,58,15,"user"],[76,23,58,19],[76,25,58,21,"name"],[76,29,58,25],[76,33,58,29,"photos"],[76,39,58,35],[76,40,58,36,"length"],[76,46,58,42],[76,49,58,45],[76,50,58,46],[76,52,58,48],[77,16,59,12,"console"],[77,23,59,19],[77,24,59,20,"log"],[77,27,59,23],[77,28,59,24],[77,103,59,99],[77,104,59,100],[78,16,60,12,"router"],[78,22,60,18],[78,23,60,19,"replace"],[78,30,60,26],[78,31,60,27],[78,52,60,48],[78,53,60,49],[79,16,61,12],[80,14,62,10],[82,14,64,10],[83,14,65,10,"console"],[83,21,65,17],[83,22,65,18,"log"],[83,25,65,21],[83,26,65,22],[83,79,65,75],[83,80,65,76],[84,14,66,10,"router"],[84,20,66,16],[84,21,66,17,"replace"],[84,28,66,24],[84,29,66,25],[84,48,66,44],[84,49,66,45],[85,14,67,10],[86,12,68,8],[87,10,69,6],[87,11,69,7],[87,12,69,8],[87,19,69,15,"e"],[87,20,69,16],[87,22,69,18],[88,12,70,8,"console"],[88,19,70,15],[88,20,70,16,"error"],[88,25,70,21],[88,26,70,22],[88,61,70,57],[88,63,70,59,"e"],[88,64,70,60],[88,65,70,61],[89,10,71,6],[91,10,73,6],[92,10,74,6,"console"],[92,17,74,13],[92,18,74,14,"log"],[92,21,74,17],[92,22,74,18],[92,76,74,72],[92,77,74,73],[93,10,75,6,"router"],[93,16,75,12],[93,17,75,13,"replace"],[93,24,75,20],[93,25,75,21],[93,44,75,40],[93,45,75,41],[94,8,76,4],[94,9,76,5],[95,8,76,5],[95,24,10,10,"routeNext"],[95,33,10,19,"routeNext"],[95,34,10,19],[96,10,10,19],[96,17,10,19,"_ref"],[96,21,10,19],[96,22,10,19,"apply"],[96,27,10,19],[96,34,10,19,"arguments"],[96,43,10,19],[97,8,10,19],[98,6,10,19],[98,9,76,5],[99,6,78,4,"routeNext"],[99,15,78,13],[99,16,78,14],[99,17,78,15],[100,4,79,2],[100,5,79,3],[100,7,79,5],[100,8,79,6,"isReady"],[100,15,79,13],[100,17,79,15,"auth"],[100,21,79,19],[100,23,79,21,"router"],[100,29,79,27],[100,30,79,28],[100,31,79,29],[101,4,81,2],[101,11,81,9],[101,15,81,13],[102,2,82,0],[103,2,82,1,"_s"],[103,4,82,1],[103,5,5,24,"Index"],[103,10,5,29],[104,4,5,29],[104,12,6,17,"useRouter"],[104,23,6,26],[104,24,6,26,"useRouter"],[104,33,6,26],[104,35,7,28,"useAuth"],[104,52,7,35],[104,53,7,35,"useAuth"],[104,60,7,35],[105,2,7,35],[106,2,7,35,"_c"],[106,4,7,35],[106,7,5,24,"Index"],[106,12,5,29],[107,2,5,29],[107,6,5,29,"_c"],[107,8,5,29],[108,2,5,29,"$RefreshReg$"],[108,14,5,29],[108,15,5,29,"_c"],[108,17,5,29],[109,0,5,29],[109,3]],"functionMap":{"names":["<global>","Index","useEffect$argument_0","routeNext","media.filter$argument_0"],"mappings":"AAA;eCI;YCI;sBCC;sCCqB,yBD;KD6C;GDG;CDG"},"hasCjsExports":false},"type":"js/module"}]}