{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":34,"index":34}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"expo-router","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":35},"end":{"line":2,"column":40,"index":75}}],"key":"/+ErnBisjrT6aDU+GRp5Qz/lYoY=","exportNames":["*"],"imports":1}},{"name":"@/utils/auth/useAuth","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":76},"end":{"line":3,"column":47,"index":123}}],"key":"OwmwtjBeuaoeWH+HHIznha/uOFE=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return Index;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _react = require(_dependencyMap[1], \"react\");\n  var _expoRouter = require(_dependencyMap[2], \"expo-router\");\n  var _utilsAuthUseAuth = require(_dependencyMap[3], \"@/utils/auth/useAuth\");\n  function Index() {\n    _s();\n    var router = (0, _expoRouter.useRouter)();\n    var _useAuth = (0, _utilsAuthUseAuth.useAuth)(),\n      isReady = _useAuth.isReady,\n      auth = _useAuth.auth;\n    (0, _react.useEffect)(() => {\n      var routeNext = /*#__PURE__*/function () {\n        var _ref = (0, _asyncToGenerator.default)(function* () {\n          if (!isReady) return;\n          console.log(\"[INDEX] Starting route logic, isReady:\", isReady, \"auth:\", !!auth);\n\n          // Not authenticated -> Welcome Back page\n          if (!auth) {\n            console.log(\"[INDEX] No auth, redirecting to welcome back page\");\n            router.replace(\"/welcome\");\n            return;\n          }\n\n          // User is authenticated - check onboarding completion\n          try {\n            console.log(\"[INDEX] Fetching profile...\");\n            var res = yield fetch(\"/api/profile\");\n            console.log(\"[INDEX] Profile fetch status:\", res.status);\n\n            // Handle 401 as true unauth (shouldn't happen with QA_BYPASS, but handle it)\n            if (res.status === 401) {\n              console.log(\"[INDEX] Got 401, redirecting to welcome\");\n              router.replace(\"/welcome\");\n              return;\n            }\n\n            // Handle server errors (5xx) or network errors - keep user on profile with error state\n            if (!res.ok && res.status >= 500) {\n              console.error(\"[INDEX] Server error fetching profile, defaulting to profile page\");\n              router.replace(\"/(tabs)/profile\");\n              return;\n            }\n            if (res.ok) {\n              var data = yield res.json();\n              var user = data?.user;\n              var media = data?.media || [];\n              var photos = media.filter(m => m.type === \"photo\");\n              console.log(\"[INDEX] User data:\", {\n                hasUser: !!user,\n                consent: user?.consent_accepted,\n                tier: user?.membership_tier,\n                name: user?.name,\n                photoCount: photos.length\n              });\n\n              // Check consent first (Step 1)\n              if (!user?.consent_accepted) {\n                console.log(\"[INDEX] No consent, redirecting to consent\");\n                var returnTo = \"/onboarding/membership\";\n                router.replace(`/onboarding/consent?returnTo=${encodeURIComponent(returnTo)}`);\n                return;\n              }\n\n              // Membership gate (Step 2)\n              if (!user?.membership_tier) {\n                console.log(\"[INDEX] No membership tier, redirecting to membership\");\n                router.replace(\"/onboarding/membership\");\n                return;\n              }\n\n              // Profile completion gate (Step 3)\n              // Require name AND minimum 2 photos to ensure profile is properly completed\n              if (!user?.name || photos.length < 2) {\n                console.log(\"[INDEX] Incomplete profile (name or photos), redirecting to profile setup\");\n                router.replace(\"/onboarding/profile\");\n                return;\n              }\n\n              // All checks passed -> Profile page for returning users\n              console.log(\"[INDEX] All checks passed, redirecting to profile\");\n              router.replace(\"/(tabs)/profile\");\n              return;\n            }\n          } catch (e) {\n            console.error(\"[INDEX] Network/fetch error during route logic:\", e);\n            // Network error while authenticated - default to profile page\n            router.replace(\"/(tabs)/profile\");\n            return;\n          }\n\n          // Fallback for other 4xx errors - go to profile with degraded state\n          console.log(\"[INDEX] Fallback triggered (4xx error), redirecting to profile\");\n          router.replace(\"/(tabs)/profile\");\n        });\n        return function routeNext() {\n          return _ref.apply(this, arguments);\n        };\n      }();\n      routeNext();\n    }, [isReady, auth, router]);\n    return null;\n  }\n  _s(Index, \"1ebaCb4fb+n283sTuLOePoZ/b3c=\", false, function () {\n    return [_expoRouter.useRouter, _utilsAuthUseAuth.useAuth];\n  });\n  _c = Index;\n  var _c;\n  $RefreshReg$(_c, \"Index\");\n});","lineCount":128,"map":[[13,2,5,15,"Object"],[13,8,5,15],[13,9,5,15,"defineProperty"],[13,23,5,15],[13,24,5,15,"exports"],[13,31,5,15],[14,4,5,15,"enumerable"],[14,14,5,15],[15,4,5,15,"get"],[15,7,5,15],[15,18,5,15,"get"],[15,19,5,15],[16,6,5,15],[16,13,5,15,"Index"],[16,18,5,15],[17,4,5,15],[18,2,5,15],[19,2,100,1],[19,6,100,1,"_babelRuntimeHelpersAsyncToGenerator"],[19,42,100,1],[19,45,100,1,"require"],[19,52,100,1],[19,53,100,1,"_dependencyMap"],[19,67,100,1],[20,2,100,1],[20,6,100,1,"_asyncToGenerator"],[20,23,100,1],[20,26,100,1,"_interopDefault"],[20,41,100,1],[20,42,100,1,"_babelRuntimeHelpersAsyncToGenerator"],[20,78,100,1],[21,2,1,0],[21,6,1,0,"_react"],[21,12,1,0],[21,15,1,0,"require"],[21,22,1,0],[21,23,1,0,"_dependencyMap"],[21,37,1,0],[22,2,2,0],[22,6,2,0,"_expoRouter"],[22,17,2,0],[22,20,2,0,"require"],[22,27,2,0],[22,28,2,0,"_dependencyMap"],[22,42,2,0],[23,2,3,0],[23,6,3,0,"_utilsAuthUseAuth"],[23,23,3,0],[23,26,3,0,"require"],[23,33,3,0],[23,34,3,0,"_dependencyMap"],[23,48,3,0],[24,2,5,15],[24,11,5,24,"Index"],[24,16,5,29,"Index"],[24,17,5,29],[24,19,5,32],[25,4,5,32,"_s"],[25,6,5,32],[26,4,6,2],[26,8,6,8,"router"],[26,14,6,14],[26,17,6,17],[26,21,6,17,"useRouter"],[26,32,6,26],[26,33,6,26,"useRouter"],[26,42,6,26],[26,44,6,27],[26,45,6,28],[27,4,7,2],[27,8,7,2,"_useAuth"],[27,16,7,2],[27,19,7,28],[27,23,7,28,"useAuth"],[27,40,7,35],[27,41,7,35,"useAuth"],[27,48,7,35],[27,50,7,36],[27,51,7,37],[28,6,7,10,"isReady"],[28,13,7,17],[28,16,7,17,"_useAuth"],[28,24,7,17],[28,25,7,10,"isReady"],[28,32,7,17],[29,6,7,19,"auth"],[29,10,7,23],[29,13,7,23,"_useAuth"],[29,21,7,23],[29,22,7,19,"auth"],[29,26,7,23],[30,4,9,2],[30,8,9,2,"useEffect"],[30,14,9,11],[30,15,9,11,"useEffect"],[30,24,9,11],[30,26,9,12],[30,32,9,18],[31,6,10,4],[31,10,10,10,"routeNext"],[31,19,10,19],[32,8,10,19],[32,12,10,19,"_ref"],[32,16,10,19],[32,23,10,19,"_asyncToGenerator"],[32,40,10,19],[32,41,10,19,"default"],[32,48,10,19],[32,50,10,22],[32,63,10,34],[33,10,11,6],[33,14,11,10],[33,15,11,11,"isReady"],[33,22,11,18],[33,24,11,20],[34,10,13,6,"console"],[34,17,13,13],[34,18,13,14,"log"],[34,21,13,17],[34,22,13,18],[34,62,13,58],[34,64,13,60,"isReady"],[34,71,13,67],[34,73,13,69],[34,80,13,76],[34,82,13,78],[34,83,13,79],[34,84,13,80,"auth"],[34,88,13,84],[34,89,13,85],[36,10,15,6],[37,10,16,6],[37,14,16,10],[37,15,16,11,"auth"],[37,19,16,15],[37,21,16,17],[38,12,17,8,"console"],[38,19,17,15],[38,20,17,16,"log"],[38,23,17,19],[38,24,17,20],[38,75,17,71],[38,76,17,72],[39,12,18,8,"router"],[39,18,18,14],[39,19,18,15,"replace"],[39,26,18,22],[39,27,18,23],[39,37,18,33],[39,38,18,34],[40,12,19,8],[41,10,20,6],[43,10,22,6],[44,10,23,6],[44,14,23,10],[45,12,24,8,"console"],[45,19,24,15],[45,20,24,16,"log"],[45,23,24,19],[45,24,24,20],[45,53,24,49],[45,54,24,50],[46,12,25,8],[46,16,25,14,"res"],[46,19,25,17],[46,28,25,26,"fetch"],[46,33,25,31],[46,34,25,32],[46,48,25,46],[46,49,25,47],[47,12,26,8,"console"],[47,19,26,15],[47,20,26,16,"log"],[47,23,26,19],[47,24,26,20],[47,55,26,51],[47,57,26,53,"res"],[47,60,26,56],[47,61,26,57,"status"],[47,67,26,63],[47,68,26,64],[49,12,28,8],[50,12,29,8],[50,16,29,12,"res"],[50,19,29,15],[50,20,29,16,"status"],[50,26,29,22],[50,31,29,27],[50,34,29,30],[50,36,29,32],[51,14,30,10,"console"],[51,21,30,17],[51,22,30,18,"log"],[51,25,30,21],[51,26,30,22],[51,67,30,63],[51,68,30,64],[52,14,31,10,"router"],[52,20,31,16],[52,21,31,17,"replace"],[52,28,31,24],[52,29,31,25],[52,39,31,35],[52,40,31,36],[53,14,32,10],[54,12,33,8],[56,12,35,8],[57,12,36,8],[57,16,36,12],[57,17,36,13,"res"],[57,20,36,16],[57,21,36,17,"ok"],[57,23,36,19],[57,27,36,23,"res"],[57,30,36,26],[57,31,36,27,"status"],[57,37,36,33],[57,41,36,37],[57,44,36,40],[57,46,36,42],[58,14,37,10,"console"],[58,21,37,17],[58,22,37,18,"error"],[58,27,37,23],[58,28,37,24],[58,95,37,91],[58,96,37,92],[59,14,38,10,"router"],[59,20,38,16],[59,21,38,17,"replace"],[59,28,38,24],[59,29,38,25],[59,46,38,42],[59,47,38,43],[60,14,39,10],[61,12,40,8],[62,12,42,8],[62,16,42,12,"res"],[62,19,42,15],[62,20,42,16,"ok"],[62,22,42,18],[62,24,42,20],[63,14,43,10],[63,18,43,16,"data"],[63,22,43,20],[63,31,43,29,"res"],[63,34,43,32],[63,35,43,33,"json"],[63,39,43,37],[63,40,43,38],[63,41,43,39],[64,14,44,10],[64,18,44,16,"user"],[64,22,44,20],[64,25,44,23,"data"],[64,29,44,27],[64,31,44,29,"user"],[64,35,44,33],[65,14,45,10],[65,18,45,16,"media"],[65,23,45,21],[65,26,45,24,"data"],[65,30,45,28],[65,32,45,30,"media"],[65,37,45,35],[65,41,45,39],[65,43,45,41],[66,14,46,10],[66,18,46,16,"photos"],[66,24,46,22],[66,27,46,25,"media"],[66,32,46,30],[66,33,46,31,"filter"],[66,39,46,37],[66,40,46,39,"m"],[66,41,46,40],[66,45,46,45,"m"],[66,46,46,46],[66,47,46,47,"type"],[66,51,46,51],[66,56,46,56],[66,63,46,63],[66,64,46,64],[67,14,48,10,"console"],[67,21,48,17],[67,22,48,18,"log"],[67,25,48,21],[67,26,48,22],[67,46,48,42],[67,48,48,44],[68,16,49,12,"hasUser"],[68,23,49,19],[68,25,49,21],[68,26,49,22],[68,27,49,23,"user"],[68,31,49,27],[69,16,50,12,"consent"],[69,23,50,19],[69,25,50,21,"user"],[69,29,50,25],[69,31,50,27,"consent_accepted"],[69,47,50,43],[70,16,51,12,"tier"],[70,20,51,16],[70,22,51,18,"user"],[70,26,51,22],[70,28,51,24,"membership_tier"],[70,43,51,39],[71,16,52,12,"name"],[71,20,52,16],[71,22,52,18,"user"],[71,26,52,22],[71,28,52,24,"name"],[71,32,52,28],[72,16,53,12,"photoCount"],[72,26,53,22],[72,28,53,24,"photos"],[72,34,53,30],[72,35,53,31,"length"],[73,14,54,10],[73,15,54,11],[73,16,54,12],[75,14,56,10],[76,14,57,10],[76,18,57,14],[76,19,57,15,"user"],[76,23,57,19],[76,25,57,21,"consent_accepted"],[76,41,57,37],[76,43,57,39],[77,16,58,12,"console"],[77,23,58,19],[77,24,58,20,"log"],[77,27,58,23],[77,28,58,24],[77,72,58,68],[77,73,58,69],[78,16,59,12],[78,20,59,18,"returnTo"],[78,28,59,26],[78,31,59,29],[78,55,59,53],[79,16,60,12,"router"],[79,22,60,18],[79,23,60,19,"replace"],[79,30,60,26],[79,31,60,27],[79,63,60,59,"encodeURIComponent"],[79,81,60,77],[79,82,60,78,"returnTo"],[79,90,60,86],[79,91,60,87],[79,93,60,89],[79,94,60,90],[80,16,61,12],[81,14,62,10],[83,14,64,10],[84,14,65,10],[84,18,65,14],[84,19,65,15,"user"],[84,23,65,19],[84,25,65,21,"membership_tier"],[84,40,65,36],[84,42,65,38],[85,16,66,12,"console"],[85,23,66,19],[85,24,66,20,"log"],[85,27,66,23],[85,28,66,24],[85,83,66,79],[85,84,66,80],[86,16,67,12,"router"],[86,22,67,18],[86,23,67,19,"replace"],[86,30,67,26],[86,31,67,27],[86,55,67,51],[86,56,67,52],[87,16,68,12],[88,14,69,10],[90,14,71,10],[91,14,72,10],[92,14,73,10],[92,18,73,14],[92,19,73,15,"user"],[92,23,73,19],[92,25,73,21,"name"],[92,29,73,25],[92,33,73,29,"photos"],[92,39,73,35],[92,40,73,36,"length"],[92,46,73,42],[92,49,73,45],[92,50,73,46],[92,52,73,48],[93,16,74,12,"console"],[93,23,74,19],[93,24,74,20,"log"],[93,27,74,23],[93,28,74,24],[93,103,74,99],[93,104,74,100],[94,16,75,12,"router"],[94,22,75,18],[94,23,75,19,"replace"],[94,30,75,26],[94,31,75,27],[94,52,75,48],[94,53,75,49],[95,16,76,12],[96,14,77,10],[98,14,79,10],[99,14,80,10,"console"],[99,21,80,17],[99,22,80,18,"log"],[99,25,80,21],[99,26,80,22],[99,77,80,73],[99,78,80,74],[100,14,81,10,"router"],[100,20,81,16],[100,21,81,17,"replace"],[100,28,81,24],[100,29,81,25],[100,46,81,42],[100,47,81,43],[101,14,82,10],[102,12,83,8],[103,10,84,6],[103,11,84,7],[103,12,84,8],[103,19,84,15,"e"],[103,20,84,16],[103,22,84,18],[104,12,85,8,"console"],[104,19,85,15],[104,20,85,16,"error"],[104,25,85,21],[104,26,85,22],[104,75,85,71],[104,77,85,73,"e"],[104,78,85,74],[104,79,85,75],[105,12,86,8],[106,12,87,8,"router"],[106,18,87,14],[106,19,87,15,"replace"],[106,26,87,22],[106,27,87,23],[106,44,87,40],[106,45,87,41],[107,12,88,8],[108,10,89,6],[110,10,91,6],[111,10,92,6,"console"],[111,17,92,13],[111,18,92,14,"log"],[111,21,92,17],[111,22,92,18],[111,86,92,82],[111,87,92,83],[112,10,93,6,"router"],[112,16,93,12],[112,17,93,13,"replace"],[112,24,93,20],[112,25,93,21],[112,42,93,38],[112,43,93,39],[113,8,94,4],[113,9,94,5],[114,8,94,5],[114,24,10,10,"routeNext"],[114,33,10,19,"routeNext"],[114,34,10,19],[115,10,10,19],[115,17,10,19,"_ref"],[115,21,10,19],[115,22,10,19,"apply"],[115,27,10,19],[115,34,10,19,"arguments"],[115,43,10,19],[116,8,10,19],[117,6,10,19],[117,9,94,5],[118,6,96,4,"routeNext"],[118,15,96,13],[118,16,96,14],[118,17,96,15],[119,4,97,2],[119,5,97,3],[119,7,97,5],[119,8,97,6,"isReady"],[119,15,97,13],[119,17,97,15,"auth"],[119,21,97,19],[119,23,97,21,"router"],[119,29,97,27],[119,30,97,28],[119,31,97,29],[120,4,99,2],[120,11,99,9],[120,15,99,13],[121,2,100,0],[122,2,100,1,"_s"],[122,4,100,1],[122,5,5,24,"Index"],[122,10,5,29],[123,4,5,29],[123,12,6,17,"useRouter"],[123,23,6,26],[123,24,6,26,"useRouter"],[123,33,6,26],[123,35,7,28,"useAuth"],[123,52,7,35],[123,53,7,35,"useAuth"],[123,60,7,35],[124,2,7,35],[125,2,7,35,"_c"],[125,4,7,35],[125,7,5,24,"Index"],[125,12,5,29],[126,2,5,29],[126,6,5,29,"_c"],[126,8,5,29],[127,2,5,29,"$RefreshReg$"],[127,14,5,29],[127,15,5,29,"_c"],[127,17,5,29],[128,0,5,29],[128,3]],"functionMap":{"names":["<global>","Index","useEffect$argument_0","routeNext","media.filter$argument_0"],"mappings":"AAA;eCI;YCI;sBCC;sCCoC,yBD;KDgD;GDG;CDG"},"hasCjsExports":false},"type":"js/module"}]}